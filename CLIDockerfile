FROM openjdk:11-jre-slim

RUN apt-get update && apt-get install -y curl

# Copy job config files
COPY jobs/ /var/jenkins_home/jobs/

COPY wait-for-it.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/wait-for-it.sh
RUN /usr/local/bin/wait-for-it.sh jenkins-server:8080 -t 60

# Download Jenkins CLI
RUN curl --silent --location http://jenkins-server:8080/jnlpJars/jenkins-cli.jar -o /usr/local/bin/jenkins-cli.jar

# Run Jenkins CLI command to create job
CMD ["java", "-jar","/var/jenkins_home/jenkins-cli.jar", "-s", "http://jenkins-server:8080/", "-auth", "admin:admin", "create-job", "triggerpythonjob", "<", "/var/jenkins_home/jobs/triggerpythonjob/config.xml"]